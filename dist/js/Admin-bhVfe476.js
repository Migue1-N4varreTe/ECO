var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,t=(s,r,a)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,n=(e,s)=>{for(var r in s||(s={}))i.call(s,r)&&t(e,r,s[r]);if(a)for(var r of a(s))l.call(s,r)&&t(e,r,s[r]);return e},c=(e,a)=>s(e,r(a)),d=(e,s,r)=>new Promise((a,i)=>{var l=e=>{try{n(r.next(e))}catch(s){i(s)}},t=e=>{try{n(r.throw(e))}catch(s){i(s)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,t);n((r=r.apply(e,s)).next())});import{j as o,bi as x,bo as m,a9 as h,bp as j,bq as u,at as p}from"./chunk-D1ivKm1I.js";import{a as v}from"./chunk-CNNdbZTC.js";import{m as f,p as g,N,P as y,C as b,n as E,o as _,e as w,y as L,D as C,q as R,B as P,r as V,t as O,v as S,w as A,L as U,I as k,b as I,z as D}from"./index-17eEFbcJ.js";import{S as z,a as G,b as F,c as H,d as T}from"./chunk-DQJYHBrk.js";import{T as M,a as q,b as W,c as B,d as J,e as K}from"./chunk-D6McqOhn.js";import{T as Q,a as X,b as Y,c as Z}from"./chunk-BDIyvL0l.js";import"./chunk-DGERTDnL.js";import"./chunk-BdChqvju.js";import"./chunk-B5XYL1Sr.js";const $={LEVEL_5_DEVELOPER:"Desarrollador",LEVEL_4_OWNER:"Propietario",LEVEL_3_MANAGER:"Gerente",LEVEL_2_SUPERVISOR:"Supervisor",LEVEL_1_CASHIER:"Cajero"},ee={LEVEL_5_DEVELOPER:"bg-purple-100 text-purple-800",LEVEL_4_OWNER:"bg-red-100 text-red-800",LEVEL_3_MANAGER:"bg-blue-100 text-blue-800",LEVEL_2_SUPERVISOR:"bg-green-100 text-green-800",LEVEL_1_CASHIER:"bg-gray-100 text-gray-800"},se=()=>{const{user:e,hasPermission:s}=f(),{toast:r}=g(),[a,i]=v.useState([]),[l,t]=v.useState(!0),[se,re]=v.useState(null),[ae,ie]=v.useState(!1),[le,te]=v.useState({email:"",password:"",first_name:"",last_name:"",role:"LEVEL_1_CASHIER"}),ne=()=>d(null,null,function*(){try{t(!0);const e=yield D.getUsers();i(e)}catch(e){r({title:"Error",description:"No se pudieron cargar los usuarios",variant:"destructive"})}finally{t(!1)}});return v.useEffect(()=>{ne()},[]),e?o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100",children:[o.jsx(N,{}),o.jsx("div",{className:"container mx-auto px-4 py-8",children:o.jsxs(y,{permission:"staff:view",fallback:o.jsxs("div",{className:"text-center py-12",children:[o.jsx(h,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),o.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Acceso Restringido"}),o.jsx("p",{className:"text-gray-600",children:"No tienes permisos para acceder al panel de administración"})]}),children:[o.jsxs("div",{className:"mb-8",children:[o.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Panel de Administración"}),o.jsx("p",{className:"text-gray-600",children:"Gestiona usuarios, roles y permisos del sistema"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[o.jsxs(b,{children:[o.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(_,{className:"text-sm font-medium",children:"Total Usuarios"}),o.jsx(x,{className:"h-4 w-4 text-muted-foreground"})]}),o.jsx(w,{children:o.jsx("div",{className:"text-2xl font-bold",children:a.length})})]}),o.jsxs(b,{children:[o.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(_,{className:"text-sm font-medium",children:"Usuarios Activos"}),o.jsx(m,{className:"h-4 w-4 text-muted-foreground"})]}),o.jsx(w,{children:o.jsx("div",{className:"text-2xl font-bold",children:a.filter(e=>e.is_active).length})})]}),o.jsxs(b,{children:[o.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(_,{className:"text-sm font-medium",children:"Gerentes"}),o.jsx(h,{className:"h-4 w-4 text-muted-foreground"})]}),o.jsx(w,{children:o.jsx("div",{className:"text-2xl font-bold",children:a.filter(e=>e.level>=3).length})})]}),o.jsxs(b,{children:[o.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(_,{className:"text-sm font-medium",children:"Cajeros"}),o.jsx(j,{className:"h-4 w-4 text-muted-foreground"})]}),o.jsx(w,{children:o.jsx("div",{className:"text-2xl font-bold",children:a.filter(e=>1===e.level).length})})]})]}),o.jsxs(Q,{defaultValue:"users",className:"space-y-6",children:[o.jsxs(X,{children:[o.jsx(Y,{value:"users",children:"Gestión de Usuarios"}),o.jsx(Y,{value:"permissions",children:"Permisos"}),o.jsx(Y,{value:"audit",children:"Auditoría"})]}),o.jsx(Z,{value:"users",className:"space-y-6",children:o.jsxs(b,{children:[o.jsx(E,{children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx(_,{children:"Usuarios del Sistema"}),o.jsx(L,{children:"Gestiona usuarios, roles y permisos de acceso"})]}),o.jsx(y,{permission:"staff:create",children:o.jsxs(C,{open:ae,onOpenChange:ie,children:[o.jsx(R,{asChild:!0,children:o.jsxs(P,{children:[o.jsx(u,{className:"mr-2 h-4 w-4"}),"Crear Usuario"]})}),o.jsxs(V,{children:[o.jsxs(O,{children:[o.jsx(S,{children:"Crear Nuevo Usuario"}),o.jsx(A,{children:"Completa la información para crear un nuevo usuario"})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx(U,{htmlFor:"first_name",children:"Nombre"}),o.jsx(k,{id:"first_name",value:le.first_name,onChange:e=>te(c(n({},le),{first_name:e.target.value}))})]}),o.jsxs("div",{children:[o.jsx(U,{htmlFor:"last_name",children:"Apellido"}),o.jsx(k,{id:"last_name",value:le.last_name,onChange:e=>te(c(n({},le),{last_name:e.target.value}))})]})]}),o.jsxs("div",{children:[o.jsx(U,{htmlFor:"email",children:"Email"}),o.jsx(k,{id:"email",type:"email",value:le.email,onChange:e=>te(c(n({},le),{email:e.target.value}))})]}),o.jsxs("div",{children:[o.jsx(U,{htmlFor:"password",children:"Contraseña"}),o.jsx(k,{id:"password",type:"password",value:le.password,onChange:e=>te(c(n({},le),{password:e.target.value}))})]}),o.jsxs("div",{children:[o.jsx(U,{htmlFor:"role",children:"Rol"}),o.jsxs(z,{value:le.role,onValueChange:e=>te(c(n({},le),{role:e})),children:[o.jsx(G,{children:o.jsx(F,{})}),o.jsx(H,{children:Object.entries($).map(([e,s])=>o.jsx(T,{value:e,children:s},e))})]})]}),o.jsxs("div",{className:"flex justify-end space-x-2",children:[o.jsx(P,{variant:"outline",onClick:()=>ie(!1),children:"Cancelar"}),o.jsx(P,{onClick:()=>d(null,null,function*(){try{yield D.register(le),r({title:"Éxito",description:"Usuario creado exitosamente"}),ie(!1),te({email:"",password:"",first_name:"",last_name:"",role:"LEVEL_1_CASHIER"}),ne()}catch(e){r({title:"Error",description:e.message||"No se pudo crear el usuario",variant:"destructive"})}}),children:"Crear Usuario"})]})]})]})]})})]})}),o.jsx(w,{children:l?o.jsx("div",{className:"text-center py-8",children:"Cargando usuarios..."}):o.jsxs(M,{children:[o.jsx(q,{children:o.jsxs(W,{children:[o.jsx(B,{children:"Usuario"}),o.jsx(B,{children:"Email"}),o.jsx(B,{children:"Rol"}),o.jsx(B,{children:"Estado"}),o.jsx(B,{children:"Último Acceso"}),o.jsx(B,{children:"Acciones"})]})}),o.jsx(J,{children:a.map(e=>o.jsxs(W,{children:[o.jsx(K,{children:o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium",children:[e.first_name," ",e.last_name]}),o.jsxs("div",{className:"text-sm text-gray-500",children:["Nivel ",e.level]})]})}),o.jsx(K,{children:e.email}),o.jsx(K,{children:o.jsx(I,{className:ee[e.role],children:$[e.role]})}),o.jsx(K,{children:o.jsx(I,{variant:e.is_active?"default":"secondary",children:e.is_active?"Activo":"Inactivo"})}),o.jsx(K,{children:e.last_login_at?new Date(e.last_login_at).toLocaleDateString():"Nunca"}),o.jsx(K,{children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx(y,{permission:"staff:manage_roles",children:o.jsxs(z,{value:e.role,onValueChange:s=>((e,s)=>d(null,null,function*(){try{yield D.updateUserRole(e,s),r({title:"Éxito",description:"Rol actualizado exitosamente"}),ne()}catch(a){r({title:"Error",description:a.message||"No se pudo actualizar el rol",variant:"destructive"})}}))(e.id,s),children:[o.jsx(G,{className:"w-32",children:o.jsx(F,{})}),o.jsx(H,{children:Object.entries($).map(([e,s])=>o.jsx(T,{value:e,children:s},e))})]})}),o.jsx(y,{level:2,children:o.jsxs(P,{size:"sm",variant:"outline",onClick:()=>{return s=e.id,a="sales:apply_discount",d(null,null,function*(){try{yield D.grantTemporaryPermission(s,a,120),r({title:"Éxito",description:"Permiso temporal otorgado por 2 horas"})}catch(e){r({title:"Error",description:e.message||"No se pudo otorgar el permiso temporal",variant:"destructive"})}});var s,a},children:[o.jsx(p,{className:"h-4 w-4 mr-1"}),"Permiso Temp"]})})]})})]},e.id))})]})})]})}),o.jsx(Z,{value:"permissions",children:o.jsxs(b,{children:[o.jsxs(E,{children:[o.jsx(_,{children:"Matriz de Permisos"}),o.jsx(L,{children:"Visualiza los permisos por rol en el sistema"})]}),o.jsx(w,{children:o.jsx("div",{className:"text-center py-8 text-gray-500",children:"Matriz de permisos en desarrollo..."})})]})}),o.jsx(Z,{value:"audit",children:o.jsxs(b,{children:[o.jsxs(E,{children:[o.jsx(_,{children:"Registro de Auditoría"}),o.jsx(L,{children:"Historial de acciones importantes del sistema"})]}),o.jsx(w,{children:o.jsx("div",{className:"text-center py-8 text-gray-500",children:"Registro de auditoría en desarrollo..."})})]})})]})]})})]}):o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100",children:[o.jsx(N,{}),o.jsx("div",{className:"container mx-auto px-4 py-8",children:o.jsx("div",{className:"text-center py-12",children:o.jsx("p",{className:"text-gray-600",children:"Debes iniciar sesión para acceder a esta página"})})})]})};export{se as default};
