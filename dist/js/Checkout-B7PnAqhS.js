var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,t=(s,a,l)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[a]=l,n=(e,s)=>{for(var a in s||(s={}))r.call(s,a)&&t(e,a,s[a]);if(l)for(var a of l(s))i.call(s,a)&&t(e,a,s[a]);return e},c=(e,l)=>s(e,a(l));import{j as d,ag as m,aM as o,ap as x,at as h,aF as j,aw as p,aD as u,aO as v,aP as g,a6 as N}from"./chunk-D1ivKm1I.js";import{h as f,a as b}from"./chunk-CNNdbZTC.js";import{m as y,k as C,l as w,N as P,B as k,d as F,C as M,e as O,L as S,I as $,n as E,o as D,b as T}from"./index-17eEFbcJ.js";import{S as A}from"./chunk-BZj8Mp6R.js";import{S as V,a as X,b as I,c as R,d as z}from"./chunk-DQJYHBrk.js";import{T as L}from"./chunk-DtJU0gqK.js";import{C as q}from"./chunk-BdI_uPPx.js";import"./chunk-DGERTDnL.js";import"./chunk-BdChqvju.js";import"./chunk-B5XYL1Sr.js";const B=[{id:"card",name:"Tarjeta de cr√©dito/d√©bito",type:"card",icon:d.jsx(j,{className:"w-5 h-5"}),description:"Visa, Mastercard, American Express",available:!0},{id:"mercadopago",name:"Mercado Pago",type:"digital_wallet",icon:d.jsx(v,{className:"w-5 h-5"}),description:"Paga con tu cuenta de Mercado Pago",available:!0},{id:"paypal",name:"PayPal",type:"digital_wallet",icon:d.jsx(g,{className:"w-5 h-5"}),description:"Paga con tu cuenta de PayPal",available:!0},{id:"oxxo",name:"OXXO",type:"cash",icon:d.jsx(N,{className:"w-5 h-5"}),description:"Paga en efectivo en tiendas OXXO",fees:10,available:!0}],J=()=>{var e,s,a,l,r;const{user:i,isAuthenticated:t}=y(),v=f(),[g,N]=b.useState("express"),[J,G]=b.useState(""),[_,H]=b.useState(!1),[K,Y]=b.useState(1),[Q,U]=b.useState(!t),[W,Z]=b.useState({email:"",name:"",phone:""}),[ee,se]=b.useState({street:(null==(e=null==i?void 0:i.address)?void 0:e.street)||"",city:(null==(s=null==i?void 0:i.address)?void 0:s.city)||"M√©xico",state:(null==(a=null==i?void 0:i.address)?void 0:a.state)||"CDMX",postalCode:(null==(l=null==i?void 0:i.address)?void 0:l.postalCode)||"",references:""}),[ae,le]=b.useState({number:"",expiry:"",cvv:"",name:(null==i?void 0:i.name)||""});b.useEffect(()=>{t||U(!0)},[t]);const{cartProducts:re,cartCount:ie,cartSubtotal:te}=C(),ne=te,ce=w.find(e=>e.id===g),de=(null==ce?void 0:ce.price)||0,me=B.find(e=>e.id===J),oe=(null==me?void 0:me.fees)||0,xe=ne+de+oe,he=(e,s)=>{se(a=>c(n({},a),{[e]:s}))},je=(e,s)=>{let a=s;"number"===e&&(a=s.replace(/\s/g,"").replace(/(.{4})/g,"$1 ").trim(),a.length>19)||"expiry"===e&&(a=s.replace(/\D/g,"").replace(/(.{2})(.{2})/,"$1/$2"),a.length>5)||"cvv"===e&&s.length>3||le(s=>c(n({},s),{[e]:a}))},pe=e=>{switch(e){case 1:const e=!!(ee.street&&ee.city&&ee.state&&ee.postalCode);if(Q&&!t){const s=!!(W.name&&W.email&&W.phone);return e&&s}return e;case 2:return"card"===J?!(16!==ae.number.replace(/\s/g,"").length||5!==ae.expiry.length||3!==ae.cvv.length||!ae.name):!!J;default:return!0}},ue=()=>{pe(K)&&Y(K+1)},ve=[{number:1,title:"Direcci√≥n",description:"Confirma tu direcci√≥n"},{number:2,title:"Pago",description:"Selecciona m√©todo de pago"},{number:3,title:"Confirmaci√≥n",description:"Revisa tu pedido"}];return d.jsxs("div",{className:"min-h-screen bg-gray-50",children:[d.jsx(P,{}),d.jsxs("div",{className:"container px-4 py-8",children:[d.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[d.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>v("/cart"),children:[d.jsx(m,{className:"w-4 h-4 mr-2"}),"Volver al carrito"]}),d.jsxs("div",{children:[d.jsx("h1",{className:"font-display font-bold text-2xl md:text-3xl text-gray-900",children:"Finalizar pedido"}),d.jsxs("p",{className:"text-gray-600",children:["Completa tu compra de ",ie," ",1===ie?"producto":"productos"]})]})]}),d.jsx("div",{className:"mb-8",children:d.jsx("div",{className:"flex justify-between items-center",children:ve.map((e,s)=>d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:F("w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium",K>=e.number?"bg-brand-500 text-white":"bg-gray-200 text-gray-600"),children:K>e.number?d.jsx(o,{className:"w-5 h-5"}):e.number}),s<ve.length-1&&d.jsx("div",{className:F("flex-1 h-0.5 mx-4",K>e.number?"bg-brand-500":"bg-gray-200")})]}),d.jsxs("div",{className:"mt-2 hidden sm:block",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.title}),d.jsx("p",{className:"text-xs text-gray-600",children:e.description})]})]},e.number))})}),d.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[d.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[1===K&&d.jsx(M,{className:"animate-slide-in bg-gradient-to-r from-blue-50 to-brand-50 border-brand-200",children:d.jsxs(O,{className:"pt-6",children:[!t&&d.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[d.jsx(q,{id:"guest-checkout",checked:Q,onCheckedChange:U}),d.jsx(S,{htmlFor:"guest-checkout",className:"font-medium",children:"Continuar como invitado (sin crear cuenta)"})]}),t&&d.jsx("div",{className:"text-center mb-4",children:d.jsx("p",{className:"text-sm text-gray-600",children:"¬°Bienvenido de vuelta! Tu informaci√≥n guardada se usar√° autom√°ticamente."})}),Q&&!t&&d.jsxs("div",{className:"grid md:grid-cols-3 gap-4 pt-4 border-t border-brand-200",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(S,{htmlFor:"guest-name",children:"Nombre completo *"}),d.jsx($,{id:"guest-name",value:W.name,onChange:e=>Z(s=>c(n({},s),{name:e.target.value})),placeholder:"Tu nombre completo"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(S,{htmlFor:"guest-email",children:"Email *"}),d.jsx($,{id:"guest-email",type:"email",value:W.email,onChange:e=>Z(s=>c(n({},s),{email:e.target.value})),placeholder:"tu@email.com"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(S,{htmlFor:"guest-phone",children:"Tel√©fono *"}),d.jsx($,{id:"guest-phone",value:W.phone,onChange:e=>Z(s=>c(n({},s),{phone:e.target.value})),placeholder:"(000) 000-0000"})]})]}),!Q&&!t&&d.jsxs("div",{className:"text-center pt-4 border-t border-brand-200",children:[d.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["¬øYa tienes cuenta?"," ",d.jsx("a",{href:"/login",className:"text-brand-600 hover:underline",children:"Inicia sesi√≥n aqu√≠"})]}),d.jsxs("p",{className:"text-xs text-gray-500",children:["O"," ",d.jsx("a",{href:"/register",className:"text-brand-600 hover:underline",children:"crea una cuenta nueva"})," ","para acceder a ofertas exclusivas"]})]})]})}),1===K&&d.jsxs(M,{className:"animate-slide-in",children:[d.jsx(E,{children:d.jsxs(D,{className:"flex items-center gap-2",children:[d.jsx(x,{className:"w-5 h-5 text-brand-500"}),"Direcci√≥n de entrega"]})}),d.jsxs(O,{className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"md:col-span-2",children:[d.jsx(S,{htmlFor:"street",children:"Calle y n√∫mero"}),d.jsx($,{id:"street",value:ee.street,onChange:e=>he("street",e.target.value),placeholder:"Av. Polanco 123",className:"mt-1"})]}),d.jsxs("div",{children:[d.jsx(S,{htmlFor:"city",children:"Ciudad"}),d.jsx($,{id:"city",value:ee.city,onChange:e=>he("city",e.target.value),placeholder:"M√©xico",className:"mt-1"})]}),d.jsxs("div",{children:[d.jsx(S,{htmlFor:"state",children:"Estado"}),d.jsxs(V,{value:ee.state,onValueChange:e=>he("state",e),children:[d.jsx(X,{className:"mt-1",children:d.jsx(I,{})}),d.jsxs(R,{children:[d.jsx(z,{value:"CDMX",children:"Ciudad de M√©xico"}),d.jsx(z,{value:"MEX",children:"Estado de M√©xico"}),d.jsx(z,{value:"JAL",children:"Jalisco"}),d.jsx(z,{value:"NL",children:"Nuevo Le√≥n"})]})]})]}),d.jsxs("div",{children:[d.jsx(S,{htmlFor:"postalCode",children:"C√≥digo postal"}),d.jsx($,{id:"postalCode",value:ee.postalCode,onChange:e=>he("postalCode",e.target.value),placeholder:"11550",className:"mt-1"})]}),d.jsxs("div",{className:"md:col-span-2",children:[d.jsx(S,{htmlFor:"references",children:"Referencias de entrega"}),d.jsx(L,{id:"references",value:ee.references,onChange:e=>he("references",e.target.value),placeholder:"Edificio azul, departamento 4B, tocar timbre",className:"mt-1",rows:3})]})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsx(S,{children:"M√©todo de entrega"}),w.map(e=>d.jsxs("label",{className:F("flex items-center justify-between p-4 border rounded-lg cursor-pointer transition-colors",g===e.id?"border-brand-500 bg-brand-50":"border-gray-200 hover:border-gray-300"),children:[d.jsx("input",{type:"radio",name:"delivery",value:e.id,checked:g===e.id,onChange:e=>N(e.target.value),className:"sr-only"}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"text-xl",children:e.icon}),d.jsxs("div",{children:[d.jsx("div",{className:"font-medium text-sm",children:e.name}),d.jsx("div",{className:"text-xs text-gray-600",children:e.description}),d.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1 mt-1",children:[d.jsx(h,{className:"w-3 h-3"}),e.time]})]})]}),d.jsx("div",{className:"font-semibold text-sm",children:0===e.price?"Gratis":`$${e.price}`})]},e.id))]}),d.jsx(k,{onClick:ue,className:"w-full btn-gradient",disabled:!pe(1),children:"Continuar al pago"})]})]}),2===K&&d.jsxs(M,{className:"animate-slide-in",children:[d.jsx(E,{children:d.jsxs(D,{className:"flex items-center gap-2",children:[d.jsx(j,{className:"w-5 h-5 text-brand-500"}),"M√©todo de pago"]})}),d.jsxs(O,{className:"space-y-6",children:[d.jsx("div",{className:"space-y-3",children:B.map(e=>d.jsxs("label",{className:F("flex items-center justify-between p-4 border rounded-lg cursor-pointer transition-colors",J===e.id?"border-brand-500 bg-brand-50":"border-gray-200 hover:border-gray-300",!e.available&&"opacity-50 cursor-not-allowed"),children:[d.jsx("input",{type:"radio",name:"payment",value:e.id,checked:J===e.id,onChange:e=>G(e.target.value),disabled:!e.available,className:"sr-only"}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"text-brand-600",children:e.icon}),d.jsxs("div",{children:[d.jsxs("div",{className:"font-medium text-sm flex items-center gap-2",children:[e.name,e.fees&&d.jsxs(T,{variant:"outline",className:"text-xs",children:["+$",e.fees]})]}),d.jsx("div",{className:"text-xs text-gray-600",children:e.description})]})]}),d.jsx("div",{className:"flex items-center gap-2",children:d.jsx(p,{className:"w-4 h-4 text-green-500"})})]},e.id))}),"card"===J&&d.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg",children:[d.jsx(S,{className:"text-sm font-medium",children:"Detalles de la tarjeta"}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"md:col-span-2",children:[d.jsx(S,{htmlFor:"cardNumber",className:"text-xs",children:"N√∫mero de tarjeta"}),d.jsx($,{id:"cardNumber",value:ae.number,onChange:e=>je("number",e.target.value),placeholder:"1234 5678 9012 3456",className:"mt-1"})]}),d.jsxs("div",{children:[d.jsx(S,{htmlFor:"expiry",className:"text-xs",children:"Fecha de vencimiento"}),d.jsx($,{id:"expiry",value:ae.expiry,onChange:e=>je("expiry",e.target.value),placeholder:"MM/AA",className:"mt-1"})]}),d.jsxs("div",{children:[d.jsx(S,{htmlFor:"cvv",className:"text-xs",children:"CVV"}),d.jsx($,{id:"cvv",value:ae.cvv,onChange:e=>je("cvv",e.target.value),placeholder:"123",className:"mt-1"})]}),d.jsxs("div",{className:"md:col-span-2",children:[d.jsx(S,{htmlFor:"cardName",className:"text-xs",children:"Nombre del titular"}),d.jsx($,{id:"cardName",value:ae.name,onChange:e=>je("name",e.target.value),placeholder:"Juan P√©rez",className:"mt-1"})]})]})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx(k,{variant:"outline",onClick:()=>Y(1),className:"flex-1",children:"Volver"}),d.jsx(k,{onClick:ue,className:"flex-1 btn-gradient",disabled:!pe(2),children:"Revisar pedido"})]})]})]}),3===K&&d.jsxs(M,{className:"animate-slide-in",children:[d.jsx(E,{children:d.jsxs(D,{className:"flex items-center gap-2",children:[d.jsx(o,{className:"w-5 h-5 text-green-500"}),"Confirmar pedido"]})}),d.jsxs(O,{className:"space-y-6",children:[d.jsxs("div",{className:"space-y-4",children:[Q&&!t&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"flex items-center justify-between",children:d.jsx("span",{className:"font-medium",children:"Informaci√≥n del cliente:"})}),d.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg",children:[d.jsxs("p",{children:[d.jsx("strong",{children:"Nombre:"})," ",W.name]}),d.jsxs("p",{children:[d.jsx("strong",{children:"Email:"})," ",W.email]}),d.jsxs("p",{children:[d.jsx("strong",{children:"Tel√©fono:"})," ",W.phone]})]})]}),d.jsx("div",{className:"flex items-center justify-between",children:d.jsx("span",{className:"font-medium",children:"Direcci√≥n de entrega:"})}),d.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:[d.jsx("p",{children:ee.street}),d.jsxs("p",{children:[ee.city,", ",ee.state," ",ee.postalCode]}),ee.references&&d.jsxs("p",{className:"mt-1 text-xs",children:["Referencias: ",ee.references]})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"font-medium",children:"M√©todo de entrega:"}),d.jsxs("span",{className:"text-sm",children:[null==ce?void 0:ce.name," - ",null==ce?void 0:ce.time]})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"font-medium",children:"M√©todo de pago:"}),d.jsx("span",{className:"text-sm",children:null==(r=B.find(e=>e.id===J))?void 0:r.name})]})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx(k,{variant:"outline",onClick:()=>Y(2),className:"flex-1",children:"Volver"}),d.jsx(k,{onClick:()=>{return e=null,s=null,a=function*(){if(pe(2)){H(!0);try{t&&(null==i||i.id),n({method:J},"card"===J&&{cardDetails:ae}),yield new Promise(e=>setTimeout(e,2e3)),alert("¬°Pedido realizado con √©xito! üéâ\n\n"+(t?'Puedes ver el estado de tu pedido en "Mis Pedidos"':"Recibir√°s un email de confirmaci√≥n en "+W.email)),v("/")}catch(e){alert("Error procesando el pago. Int√©ntalo de nuevo.")}finally{H(!1)}}},new Promise((l,r)=>{var i=e=>{try{n(a.next(e))}catch(s){r(s)}},t=e=>{try{n(a.throw(e))}catch(s){r(s)}},n=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,t);n((a=a.apply(e,s)).next())});var e,s,a},className:"flex-1 btn-gradient shadow-glow",disabled:_,children:_?d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Procesando..."]}):d.jsxs(d.Fragment,{children:[d.jsx(j,{className:"w-4 h-4 mr-2"}),"Pagar $",xe.toFixed(2)]})})]})]})]})]}),d.jsx("div",{className:"space-y-6",children:d.jsxs(M,{children:[d.jsx(E,{children:d.jsx(D,{className:"text-lg",children:"Resumen del pedido"})}),d.jsxs(O,{className:"space-y-4",children:[d.jsx("div",{className:"space-y-3",children:re.map(e=>e?d.jsxs("div",{className:"flex gap-3",children:[d.jsx("img",{src:e.image,alt:e.name,className:"w-12 h-12 object-cover rounded-lg bg-gray-100"}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("p",{className:"text-sm font-medium line-clamp-1",children:e.name}),d.jsxs("p",{className:"text-xs text-gray-600",children:[e.quantity,"x $",e.price]})]}),d.jsxs("p",{className:"text-sm font-medium",children:["$",(e.price*e.quantity).toFixed(2)]})]},e.id):null)}),d.jsx(A,{}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{children:"Subtotal"}),d.jsxs("span",{children:["$",ne.toFixed(2)]})]}),d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{children:"Env√≠o"}),d.jsx("span",{children:0===de?"Gratis":`$${de}`})]}),oe>0&&d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{children:"Comisi√≥n de pago"}),d.jsxs("span",{children:["$",oe]})]}),d.jsx(A,{}),d.jsxs("div",{className:"flex justify-between font-semibold",children:[d.jsx("span",{children:"Total"}),d.jsxs("span",{children:["$",xe.toFixed(2)]})]})]}),d.jsx("div",{className:"p-3 bg-fresh-50 rounded-lg",children:d.jsxs("div",{className:"flex items-center gap-2 text-sm text-fresh-700",children:[d.jsx(u,{className:"w-4 h-4"}),d.jsxs("span",{children:["Entrega estimada: ",(null==ce?void 0:ce.time)||"N/A"]})]})})]})]})})]})]})]})};export{J as default};
